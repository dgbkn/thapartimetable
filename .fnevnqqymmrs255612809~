
<?php 
   include('session.php');
   $page_title = 'Add Ledger ';
?>
<?php include('header.php') ?>

<?php include('conn.php') ?>

<?php 
$name=$group=$addres=$ob=$intrest=$addres1=$ob_debit=$ob_credit=$gst_no=$pan_no=$phone=$email='';
$error = ['email' =>'' ,'phone' =>'' ,'name'=>'','group'=>'','addres'=>'','ob'=>'','intrest'=>'','addres1'=>'','ob_debit'=>'','ob_credit'=>'','gst_no'=>'','pan_no'=>''];

$sql123 = "SELECT name FROM `ledgers`";
$result123 = mysqli_query($conn, $sql123);










$sql_g = "SELECT name FROM `groups`";
$result_g = mysqli_query($conn, $sql_g);


        
        
        
        
        
        
        
        
        
        
        

if(isset($_POST['submit'])){


	if(empty($_POST["email"])){
		$email = "NULL";}
		else{
if (!filter_var($_POST["email"], FILTER_VALIDATE_EMAIL)) {
  $error['email'] = "Invalid email format";
}else{
$email = $_POST["email"];
}
}

if(empty($_POST["phone"])){
	$phone = 0;}else{
if (!is_numeric($_POST["phone"])) {
	$error['phone'] = "Invalid Phone Number";
  }else{
   
	  $phone = $_POST["phone"];}
  }
  
  
  
  if(empty($_POST["phone1"])){
	$phone1 = 0;}else{
if (!is_numeric($_POST["phone1"])) {
	$error['phone1'] = "Invalid Phone Number";
  }else{
   
	  $phone1 = $_POST["phone1"];}
  }
  
    // echo $_POST['group'];
   //true if form submitted
	if(empty($_POST['name'])){
		$error['name'] = "Enter name";}
		else{ 
			$name = $_POST['name'];
			while($row = mysqli_fetch_assoc($result123)) {
				if($name == $row['name']){
                    $error['name'] = "Duplicate ledgers not allowed";
				}
			}
		}
	

	if(empty($_POST['group'])){
		$error['group'] =  "Enter group";}
		else{
			$group = $_POST['group'];
		}
	


		if(!empty($_POST['addres'])){
			$addres = $_POST['addres'];
		}else{
			$addres = "NULL";
		}
		
		if(!empty($_POST['addres1'])){
			$addres1 = $_POST['addres1'];
		}else{
			$addres1 = "NULL";
		}
	
		
		if(!empty($_POST['ob'])){
		
			$ob = $_POST['ob'];
		}else{
			$ob = "NULL";
		}
			


		if(!empty($_POST['intrest'])){
	
			$intrest = $_POST['intrest'];
		}else{
			$intrest = "NULL";
		}
			
		if(!empty($_POST['ob_credit'])){
	
			$ob_credit = $_POST['ob_credit'];
		}else{
			$ob_credit = "NULL";
		}

		if(!empty($_POST['ob_debit'])){
	
			$ob_debit = $_POST['ob_debit'];
		}else{
			$ob_debit = "NULL";
		}
		
		if(!empty($_POST['pan_no'])){
			$pan_no = $_POST['pan_no'];
		}else{
			$pan_no = 0;
		}

		if(!empty($_POST['gst_no'])){
			$gst_no = $_POST['gst_no'];
		}else{
			$gst_no = 0;
		}

			
		
		
	
		if(!array_filter($error)){

			
			$sql = "INSERT INTO `ledgers` (`name`,`groups`,`addres`,`addres1`,`open_balance`,`pan_no`,`gst_no`,`company`,`intrest`,`OP_CREDIT`,`OP_DEBIT`,`phone`,`email`,`phone1`)
			VALUES ('$name','$group','$addres','$addres1',$ob,'$pan_no','$gst_no', '$company_current' , $intrest,$ob_credit,$ob_debit,'$phone','$email','$phone1')";
			
			if (!mysqli_query($conn, $sql)) {
				echo '<div class="container">'."<h6> Error: ". $sql . "<br>" . mysqli_error($conn).'</div>';
			}else{ 
				echo '<script>location.replace("view_ledger.php");</script>';
			mysqli_close($conn);
			}
		}

}


else{
	//false if
	
	
}
?>


<section class="container grey-text">


	<form class="white"style="padding: 20px;margin: 10px auto;max-width: 500px;margin-bottom:40px;" action="add_ledger.php" method="POST">
	    
	    
	    
	 <label>Name:</label>
	 <input name="name" id="name" type="text" value="<?php echo htmlspecialchars($name)?>">
	 <div class="red-text"><?php echo htmlspecialchars($error['name'])?></div>
	 
	 <label>Group:</label>


    <select class="initialized" type="text" name="group" >
         <option value="" disabled> ...Select Group... </option>
        <?php if (mysqli_num_rows($result_g) > 0) {
    // output data of each row
    while($rowg = mysqli_fetch_assoc($result_g)) { ?>
     
      <option><?php echo $rowg['name']; ?></option>
      <?php }
    
}
else{
    echo 'no groups';
} ?> ?>
    </select>
 
              

 <div class="red-text"><?php echo htmlspecialchars($error['group'])?></div>
 
 
 
 
<label>Address:</label>
<input type="text" name="addres" value="<?php echo htmlspecialchars($addres)?>">
 <div class="red-text"><?php echo htmlspecialchars($error['addres'])?></div>
 <input type="text" name="addres1" value="<?php echo htmlspecialchars($addres1)?>">
 <div class="red-text"><?php echo htmlspecialchars($error['addres1'])?></div>
 
 <label>Opening balance:</label>
<input type="number" step=any name="ob" value="<?php echo htmlspecialchars($ob)?>">
 <div class="red-text"><?php echo htmlspecialchars($error['ob'])?></div>
 
 
  <label>Intrest rate:</label>
<input type="number" step=any name="intrest" value="<?php echo htmlspecialchars($intrest)?>">
 <div class="red-text"><?php echo htmlspecialchars($error['intrest'])?></div>

 <label>Pan No.:</label>
<input type="text" name="pan_no" value="<?php echo htmlspecialchars($pan_no)?>">
 <div class="red-text"><?php echo htmlspecialchars($error['pan_no'])?></div>

 <label>Gst No.:</label>
<input type="text" name="gst_no" value="<?php echo htmlspecialchars($gst_no)?>">
 <div class="red-text"><?php echo htmlspecialchars($error['gst_no'])?></div>
 
 
 <label>Phone Number</label>
<input type="number"  name="phone" value="<?php echo htmlspecialchars($phone)?>">
 <div class="red-text"><?php echo htmlspecialchars($error['phone'])?></div>
 
 <label>Phone Number 1</label>
<input type="number"  name="phone1" value="<?php echo htmlspecialchars($phone1)?>">
 <div class="red-text"><?php echo htmlspecialchars($error['phone1'])?></div>

 
 <label>Email:</label>
<input type="email"  name="email" value="<?php echo htmlspecialchars($email)?>">
 <div class="red-text"><?php echo htmlspecialchars($error['email'])?></div>






<label>
	OB Credit or Debit
</label>

 <select class="initialized" type="text" name="obdrcr" id="obdrcr" onchange="onSelected()" onload="onSelected()">
         <option value="none" disabled selected="selected"> ...Select OB Credit or Debit... </option>
         <option value="dr">Debit</option>
         <option value ="cr">Credit</option>
        
    </select>
    <script>
    function onSelected() {
        
    var e = document.getElementById("obdrcr");
    var strUser = e.options[e.selectedIndex].value;
    
if(strUser == "dr" ){
        document.getElementById("dr.").classList.remove("hiddenn");
document.getElementById("cr.").classList.add("hiddenn");

    }
    else if(strUser == "cr" ){
        document.getElementById("cr.").classList.remove("hiddenn");
document.getElementById("dr.").classList.add("hiddenn");

    }
    else{
		document.getElementById("cr.").classList.add("hiddenn");document.getElementById("dr.").classList.add("hiddenn");
    }


}

    </script>
 

 <div id="cr." class="hiddenn">
 <label>Ob Credit:</label>
<input type="number" step=any name="ob_credit" value="<?php echo htmlspecialchars($ob_credit)?>">
</div>
 <div class="red-text"><?php echo htmlspecialchars($error['ob_credit'])?></div>
 
 <div id="dr." class="hiddenn">
  <label>OB Debit:</label>
<input type="number" step=any  name="ob_debit" value="<?php echo htmlspecialchars($ob_debit)?>">
</div>
 <div class="red-text"><?php echo htmlspecialchars($error['ob_debit'])?></div>

 












 
<div class="center">
<input type="submit" name="submit" value="submit" class="btn center white-text brand-btn"> 
	</div>
	
	</form>


</section>

<?php include('footer.php'); ?>
